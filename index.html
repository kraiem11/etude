<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã‰tude - Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„Ù…</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        :root { --main-purple: #673ab7; --accent-orange: #ffa000; --success-green: #4caf50; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        /* Header Section */
        header { background: var(--main-purple); color: white; width: 100%; padding: 25px 0; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .container { width: 90%; max-width: 500px; margin-top: 20px; }
        
        /* Status Card */
        .status-card { background: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* Lesson Cards */
        .lesson-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 8px 15px rgba(0,0,0,0.1); margin-bottom: 20px; border-right: 5px solid var(--main-purple); display: none; }
        .lesson-content { padding: 20px; }
        .lesson-price { font-weight: bold; color: var(--success-green); font-size: 1.2em; }
        
        /* Buttons */
        .btn { border: none; padding: 15px 25px; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; width: 100%; margin-top: 10px; }
        .btn-login { background: var(--accent-orange); color: white; }
        .btn-pay { background: var(--success-green); color: white; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }

        #log-area { font-size: 12px; color: #666; margin-top: 10px; background: #eee; padding: 5px; border-radius: 5px; display: none; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ“š ØªØ·Ø¨ÙŠÙ‚ Ã‰tude</h1>
    <p>ØªØ¹Ù„Ù… ÙˆØ§Ø±Ø¨Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Pi</p>
</header>

<div class="container">
    <div class="status-card" id="login-section">
        <h3 id="welcome-msg">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„ØªØ¹Ù„Ù…</h3>
        <p>Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¨Ø¯Ø¡ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø¯Ø±ÙˆØ³</p>
        <button class="btn btn-login" id="loginBtn">Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Pi Network</button>
    </div>

    <div class="lesson-card" id="lesson1">
        <div class="lesson-content">
            <h3>ğŸ“ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„: Ù…Ø¯Ø®Ù„ Ø¥Ù„Ù‰ Blockchain</h3>
            <p>ØªØ¹Ù„Ù… ÙƒÙŠÙ ØªØ¹Ù…Ù„ ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø¨Ù„ÙˆÙƒØ´ÙŠÙ† ÙÙŠ 10 Ø¯Ù‚Ø§Ø¦Ù‚.</p>
            <p class="lesson-price">Ø§Ù„Ø³Ø¹Ø±: 0.1 Ï€</p>
            <button class="btn btn-pay" onclick="requestPayment(0.1, 'Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø£ÙˆÙ„')">Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø¢Ù†</button>
            <div id="log-area"></div>
        </div>
    </div>
</div>

<script>
    const Pi = window.Pi;
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØªØ¬Ø±Ø¨Ø©
    Pi.init({ version: "2.0", sandbox: true });

    const loginBtn = document.getElementById('loginBtn');
    const loginSection = document.getElementById('login-section');
    const lessonCard = document.getElementById('lesson1');
    const welcomeMsg = document.getElementById('welcome-msg');
    const logArea = document.getElementById('log-area');

    // ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    loginBtn.onclick = async () => {
        loginBtn.disabled = true;
        loginBtn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
        
        try {
            const auth = await Pi.authenticate(['username', 'payments'], (p) => {
                console.log("Payment in progress...", p);
            });
            
            // Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¯Ø®ÙˆÙ„
            welcomeMsg.innerText = "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ " + auth.user.username;
            welcomeMsg.style.color = "#4caf50";
            loginBtn.style.display = "none";
            loginSection.querySelector('p').innerText = "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…";
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¯Ø±ÙˆØ³
            lessonCard.style.display = "block";
            
        } catch (err) {
            alert("ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + err.message);
            loginBtn.disabled = false;
            loginBtn.innerText = "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰";
        }
    };

    // ÙˆØ¸ÙŠÙØ© Ø·Ù„Ø¨ Ø§Ù„Ø¯ÙØ¹
    async function requestPayment(amt, lessonName) {
        logArea.style.display = "block";
        logArea.innerText = "Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø§Ù„Ù…Ø­ÙØ¸Ø©...";
        
        try {
            const payment = await Pi.createPayment({
                amount: amt,
                memo: "Ø´Ø±Ø§Ø¡ " + lessonName,
                metadata: { lessonId: "L1" },
            }, {
                onReadyForServerApproval: (paymentId) => {
                    logArea.innerText = "âœ… Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø¨ÙƒØ©... Ø§Ù„Ù…Ø¹Ø±Ù: " + paymentId;
                    // Ù…Ù„Ø§Ø­Ø¸Ø©: ÙÙŠ Sandbox Ù‚Ø¯ ØªÙ†ØªÙ‡ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù‡Ù†Ø§ ÙˆÙ‡Ø°Ø§ Ø·Ø¨ÙŠØ¹ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹
                },
                onReadyForServerCompletion: (paymentId, txid) => {
                    logArea.innerText = "ğŸŠ Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©: " + txid;
                    alert("ØªÙ… ÙØªØ­ Ø§Ù„Ø¯Ø±Ø³! Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„ØªØ¹Ù„Ù….");
                },
                onCancel: (paymentId) => {
                    logArea.innerText = "âŒ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….";
                },
                onError: (error, payment) => {
                    console.error(error);
                    if(error.message.includes("expired")) {
                        logArea.innerText = "ğŸ’¡ ØªØ°ÙƒÙŠØ±: Ø§Ù„Ø±Ø¨Ø· Ø³Ù„ÙŠÙ…ØŒ ÙˆÙ„ÙƒÙ† Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠØ­ØªØ§Ø¬ Ù„Ø®Ø§Ø¯Ù… (Server).";
                    } else {
                        logArea.innerText = "âš ï¸ Ø®Ø·Ø£: " + error.message;
                    }
                },
            });
        } catch (e) {
            alert("Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ: " + e.message);
        }
    }
</script>

</body>
</html>
